## 参考文章：

[前端鉴权与后端鉴权方案1](https://juejin.cn/post/7129298214959710244?searchId=202312261631413A8D7E069DEB884F8DC1)

[鉴权2](https://juejin.cn/post/6898630134530752520?searchId=202312261631413A8D7E069DEB884F8DC1)



## 什么是认证、授权、鉴权、权限控制

### 什么是认证？

> `认证(Identification)` 是指根据声明者所特有的识别信息，确认声明者的身份。
>
> 白话文的意思就是：`你需要用身份证证明你自己是你自己`。



### 什么是授权？

> `授权(Authorization)`： 在信息安全领域是指`资源所有者`委派`执行者`，赋予`执行者`指定范围的资源操作权限，以便对资源的相关操作。
>
> **在互联网领域例如：** web 服务器的 session 机制、web 浏览器的 cookie 机制、颁发授权令牌（token）等都是一个授权的机制。



### 什么是鉴权？

> `鉴权(Authentication)` 在信息安全领域是指**对于一个声明者所声明的身份权利，对其所声明的真实性进行鉴别确认的过程**。
>
> 若从授权出发，则会更加容易理解鉴权。授权和鉴权是两个上下游相匹配的关系，**先授权，后鉴权**。
>
> **在现实生活领域：** 门禁卡需要通过门禁卡识别器，银行卡需要通过银行卡识别器；
>
> **在互联网领域：** 校验 session/cookie/token 的合法性和有效性
>
> `鉴权` 是一个承上启下的一个环节，上游它接受授权的输出，校验其真实性后，然后获取权限（permission），这个将会为下一步的权限控制做好准备。



### 什么是权限控制？

> `权限控制(Access/Permission Control)` 将可执行的操作定义为权限列表，然后判断操作是否允许/禁止
>
> 对于权限控制，可以分为两部分进行理解：一个是权限，另一个是控制。权限是抽象的逻辑概念，而控制是具体的实现方式。
>
> **在现实生活领域中：** 以门禁卡的权限实现为例，一个门禁卡，拥有开公司所有的门的权限；一个门禁卡，拥有管理员角色的权限，因而可以开公司所有的门。
>
> **在互联网领域：** 通过 web 后端服务，来控制接口访问，允许或拒绝访问请求。





## HTTP基本鉴权

> 在 HTTP 中，`基本认证方案（Basic Access Authentication)` 是允许客户端（通常指的就是网页浏览器）在请求时，通过用户提供用户名和密码的方式，实现对用户身份的验证。

【注】：这种方式了解即可，没人用的





## Session-Cookie 鉴权

> `Session-Cookie` 认证是利用服务端的 **Session（会话**）和 **浏览器（客户端）** 的 Cookie 来实现的**前后端通信认证模式**。



### Session-Cookie 的认证流程图

![3.Token的认证流程图.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7beef40b29b14043ba5b0cea04d2a72f~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)

### <span style='color:red'>Session-Cookie 认证步骤解析</span>

> - **客户端：** 向服务器发送登录信息用户名/密码来请求登录校验；
>
> - **服务器：** 验证登录的信息，验证通过后自动创建 Session（将 Session 保存在内存中，也可以保存在 Redis 中），然后给这个 Session 生成一个唯一的标识字符串会话身份凭证 `session_id`(通常称为 `sid`)，并在响应头 `Set-Cookie` 中设置这个唯一标识符；
>
> > 注：可以使用签名对 `sid` 进行加密处理，服务端会根据对应的 `secret` 密钥进行解密 （非必须步骤）
>
> - **客户端：** 收到服务器的响应后会解析响应头，并自动将 `sid` 保存在本地 Cookie 中，浏览器在下次 HTTP 请求时请求头会自动附带上该域名下的 Cookie 信息；
>
> - **服务器：** 接收客户端请求时会去解析请求头 Cookie 中的 `sid`，然后根据这个 `sid` 去找服务端保存的该客户端的 `sid`，然后判断该请求是否合法；





## Token 鉴权

`Token` 是一个令牌，客户端访问服务器时，验证通过后服务端会为其签发一张令牌，之后，客户端就可以携带令牌访问服务器，服务端只需要验证令牌的**有效性**即可。

一句话概括；**访问资源接口（API）时所需要的资源凭证**



**一般 Token 的组成：**

**uid** (用户唯一的身份标识) + **time** (当前时间的时间戳) + **sign** (签名，Token 的前几位以哈希算法压缩成的一定长度的十六进制字符串)



### **Token 的认证流程图：**

![3.Token的认证流程图.png](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7beef40b29b14043ba5b0cea04d2a72f~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)







### **Token 认证步骤解析：**

> 1. **客户端：** 输入用户名和密码请求登录校验；
> 2. **服务器：** 收到请求，去验证用户名与密码；验证成功后，服务端会签发一个 Token 并把这个 Token 发送给客户端；
> 3. **客户端：** 收到 Token 以后需要把它存储起来，web 端一般会放在 localStorage 或 Cookie 中，移动端原生 APP 一般存储在本地缓存中；
> 4. **客户端发送请求：** 向服务端请求 API 资源的时候，将 Token 通过 HTTP 请求头 Authorization 字段或者其它方式发送给服务端；
> 5. **服务器：** 收到请求，然后去验证客户端请求里面带着的 Token ，如果验证成功，就向客户端返回请求的数据，否则拒绝返还（401）；



### 什么是 Refresh Token（刷新 Token）

业务接口用来鉴权的 Token，我们称之为 `Access Token`。

为了安全，我们的 `Access Token` 有效期一般设置较短，以避免被盗用。但过短的有效期会造成 `Access Token` 经常过期，过期后怎么办呢？

一种办法是：`刷新 Access Token`，让用户重新登录获取新 Token，会很麻烦；

另外一种办法是：再来一个 Token，一个专门生成 Access Token 的 Token，我们称为 `Refresh Token`；

- **Access Token：** 用来访问业务接口，由于有效期足够短，盗用风险小，也可以使请求方式更宽松灵活；
- **Refresh Token：** 用来获取 Access Token，有效期可以长一些，通过独立服务和严格的请求方式增加安全性；由于不常验证，也可以如前面的 Session 一样处理；



#### 刷新流程

![3.1RefreshToken的认证流程图.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ac396824cc4b4a88b5f57d84c1f856cc~tplv-k3u1fbpfcp-zoom-in-crop-mark:1512:0:0:0.awebp?)





#### **Refresh Token 认证步骤解析：**

> 1. **客户端：** 输入用户名和密码请求登录校验；
> 2. **服务端：** 收到请求，验证用户名与密码；验证成功后，服务端会签发一个 `Access Token` 和 `Refresh Token` 并返回给客户端；
> 3. **客户端：** 把 `Access Token` 和 `Refresh Token` 存储在本地；
> 4. **客户端发送请求：** 请求数据时，携带 `Access Token` 传输给服务端；
> 5. 服务端：
>    - 验证 Access Token 有效：正常返回数据
>    - 验证 Access Token 过期：拒绝请求
> 6. **客户端** ( Access Token 已过期) **：** 则重新传输 Refresh Token 给服务端；
> 7. **服务端** ( Access Token 已过期) **：** 验证 Refresh Token ，验证成功后返回新的 Access Token 给客户端；
> 8. **客户端：** 重新携带新的 Access Token 请求接口；





## JWT(JSON Web Token)鉴权（常用）

由于每次服务器都需要数据库中查询对比Token是否一致，这样每次请求验证都要查询数据库，增加了查库带来的延迟等性能消耗；

**那么这时候业界常用的 `JWT` 就应运而生了！！！**





### 什么是 JWT

`JWT` 是 `Auth0` 提出的通过 `对 JSON 进行加密签名`来实现授权验证的方案；

就是登录成功后将相关用户信息组成 JSON 对象，然后对这个对象进行某种方式的`加密`，返回给客户端； 客户端在下次请求时带上这个 Token； 服务端再收到请求时`校验 token 合法性`，其实也就是在校验请求的合法性。
